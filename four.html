<html>
<head>
<title>Human Capabilities - Reaction test</title> </head>
<body>

<table width = "50%" align = "center"><tr valign = "center"><td>
<h1><p id="text">Exercise D.4</p></h1>
<p id="instruction">Instructions will be shown here.</p>
<canvas id="myCanvas" width="600" height="450"></canvas>
<p>
<p id="time"></p> <p id="count"></p> <p id="mean"></p> <p id="sd"></p> </td></tr></table>

<script src = "experiment.js"> </script>

<script type="text/javascript">
	var GOOD_ALIEN = 0;
	var BAD_ALIEN = 1;
	var currentStimulus = -1;
	var canvas = document.getElementById('myCanvas');
	var context = canvas.getContext('2d');
	var imageObj = new Image();
	var imgBad = new Image();
	var imgGood = new Image();
	var imgBoom = new Image();
	var killStreak = 0;
	var bestResponseTime = 350;
	
	imageObj.src = 'background.jpg';
	imgBad.src = 'bad_alien.png';
	imgGood.src = 'good_alien.png';
	imgBoom.src = 'boom.png';
	
	var centerX = 0;
	var centerY = 0;
	
	imageObj.onload = function() {
		context.drawImage(imageObj, 0, 0, canvas.width, canvas.height);
	};

	function showSimpleStimulus() {
		var rnd = Math.random() * 100;

		var safeWidth = canvas.width - 50;
		var safeHeight = canvas.height - 250;
		centerX = Math.random() * safeWidth;
		centerY = Math.random() * safeHeight + 200;
		redrawBackground();
		
		if (rnd > 50) {
			currentStimulus = BAD_ALIEN;
			context.drawImage(imgBad, centerX, centerY, 75, 100);
			//alert("bad");
		} else {
			currentStimulus = GOOD_ALIEN;
			context.drawImage(imgGood, centerX, centerY, 50, 100);
			// draw picture of alien
		}
		currentExperiment.currentStimulus = 0;
		testActive = true;
		return currentStimulus == BAD_ALIEN;
	}

	function clearSimpleStimulus() {
		/*context.fillStyle = "rgba(255, 255, 255, 1)";
		context.drawImage(imageObj, 0, 0, canvas.width, canvas.height);*/
		
		
	}
	
	function motivationalText() {
		var text = "";
		if (killStreak > 0 && killStreak % 5 == 0) {
			text += "ACHIEVEMENT: KILL STREAK OF " + killStreak + "! ";
		}
		if (currentStimulus > -1 && currentExperiment.responses.length > 0) {
			var responseTime = currentExperiment.responses[currentExperiment.responses.length-1].responseTime;
			if (responseTime<bestResponseTime) {
				text += "FASTEST SHOT: " + responseTime + " ms!";
				bestResponseTime = responseTime;
			}
		}
		context.font="20px Georgia";
		context.fillText(text,25,50);
		context.fillStyle="#FF0000";
	}
	
	function redrawBackground() {
		context.drawImage(imageObj, 0, 0, canvas.width, canvas.height);
		motivationalText();
	}

	function onKey(e) { 
		if (e == null) {
			e = window.event;
		}
		switch (e.which || e.charCode || e.keyCode) {
			case 32:
			// space
			if (!currentExperiment.experimentActive) {
				currentExperiment.startExperiment(); 
			} else {
				if (testActive) {
					if (currentStimulus == BAD_ALIEN) {
						killStreak++;
						currentExperiment.stopTest();
					} else {
						killStreak = 0;
						currentExperiment.stopTest();
						currentExperiment.reportError();
					}
					context.drawImage(imgBoom, centerX, centerY, 50, 50);
					window.setTimeout(redrawBackground, 50);
					
				} else {
					currentExperiment.reportError();
				};
			}
			break;
			case 27: // esc
			if (currentExperiment.experimentActive) {
				currentExperiment.stopExperiment();
			}
			break;
		}
	}

	currentExperiment = new experiment(4, 
	"Our planet is under attack by space invaders (purple).<br /> Press SPACE BAR to shoot them with your BFG-9000.<br /> Make sure not to shoot any GOOD aliens (green)." +
	"Press SPACE BAR to begin.", 
	"Press SPACE BAR to shoot. Shoot the purple aliens only!", 
	showSimpleStimulus, clearSimpleStimulus, onKey, 20, ["Alien Invasion"]);
	currentExperiment.largestDelay = 3;
	currentExperiment.smallestDelay = 0.5;
</script>
</body>
</html>
